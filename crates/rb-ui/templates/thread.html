{% extends "base.html" %}

{% block content %}
<h2>Thread #{{ thread.id }} - / {{ board.slug }} /</h2>

<div class="reply-form">
    <form action="/{{ board.slug }}/post" method="POST" enctype="multipart/form-data">
        <input type="hidden" name="thread_id" value="{{ thread.id }}">
        <textarea name="content" rows="3" cols="40" placeholder="Reply content..." required></textarea><br>
        <input type="file" name="file" accept="image/*"><br>
        <button type="submit">Post Reply</button>
    </form>
</div>
<hr>

<div class="thread">
    {% for post in posts %}
    <div class="post" id="p{{ post.id }}">
        <span style="font-weight: bold;">No.{{ post.id }}</span>
        
        {# Changed to if let to handle Option<String> correctly #}
        {% if let Some(mid) = post.media_id %}
            {% if mid.len() > 4 %}
                <div class="post-media">
                    <a href="/static/uploads/{{ mid[..2] }}/{{ mid[2..4] }}/{{ mid }}" target="_blank">
                        <img src="/static/uploads/{{ mid[..2] }}/{{ mid[2..4] }}/thumb_{{ mid }}.webp" 
                            style="max-width: 250px; border: 1px solid #ccc;"
                            alt="Image">
                    </a>
                </div>
            {% else %}
                {% endif %}
        {% endif %}

        <p>{{ post.content|safe }}</p>
    </div>
    <hr />
    {% endfor %}
</div>
{% endblock %}