{% extends "base.html" %}

{% block content %}
<h2>{{ title }}</h2>

<div class="reply-form">
    <h3>Post a Reply</h3>
    <form action="/{{ board.slug }}/post" method="POST" enctype="multipart/form-data">
        <input type="hidden" name="thread_id" value="{{ thread.id }}">
        <div>
            <textarea name="content" rows="4" cols="50" required></textarea>
        </div>
        <div>
            <input type="file" name="file" accept="image/*">
            <button type="submit">Post Reply</button>
        </div>
    </form>
</div>

<div class="thread">
    {% for post in posts %}
        <div class="post">
            <span>No.{{ post.id }}</span>
            
            {# Correct way to handle Option<String> in Askama #}
            {% if post.media_id.is_some() %}
                <div class="post-media">
                    <img src="/static/uploads/{{ post.media_id.as_ref().unwrap() }}" style="max-width: 200px;">
                </div>
            {% endif %}

            <p>{{ post.content|safe }}</p>
            
            {% if !post.user_id_in_thread.is_empty() %}
                <span>ID: {{ post.user_id_in_thread }}</span>
            {% endif %}
        </div>
        <hr />
    {% endfor %}
</div>
{% endblock %}